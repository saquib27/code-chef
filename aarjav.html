<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Raksha - Volunteer Dashboard</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #f5f5f5;
            color: #333;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: between;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.4rem;
            font-weight: 600;
            color: #ff4444;
        }

        .logo i {
            margin-right: 10px;
            font-size: 1.6rem;
        }

        .volunteer-status {
            display: flex;
            align-items: center;
            margin-left: auto;
            background: #e8f5e8;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #2d5016;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Alert Notification */
        .alert-notification {
            display: none;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(255, 68, 68, 0.3);
            animation: slideIn 0.5s ease, pulse 1s ease-in-out infinite;
        }

        .alert-notification.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .alert-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .alert-header i {
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .alert-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .alert-message {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Emergency Cards */
        .emergency-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
            color: #ff4444;
        }

        .emergency-grid {
            display: grid;
            gap: 20px;
        }

        .emergency-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #ff4444;
            position: relative;
            transition: all 0.3s ease;
        }

        .emergency-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .emergency-card.urgent {
            border-left-color: #ff4444;
            animation: urgentPulse 2s ease-in-out infinite;
        }

        @keyframes urgentPulse {
            0%, 100% { box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1); }
            50% { box-shadow: 0 5px 25px rgba(255, 68, 68, 0.3); }
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .emergency-type {
            display: flex;
            align-items: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .emergency-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 68, 68, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: #ff4444;
            font-size: 1.2rem;
        }

        .timestamp {
            font-size: 0.8rem;
            color: #666;
            background: #f8f9fa;
            padding: 4px 10px;
            border-radius: 15px;
        }

        .card-content {
            margin-bottom: 20px;
        }

        .victim-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: #555;
        }

        .info-item i {
            width: 16px;
            margin-right: 8px;
            color: #666;
        }

        .location-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .location-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .location-header i {
            margin-right: 8px;
            color: #ff4444;
        }

        .map-placeholder {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1976d2;
            font-size: 0.9rem;
            margin-bottom: 8px;
            border: 2px dashed #2196f3;
        }

        .coordinates {
            font-size: 0.8rem;
            color: #666;
            font-family: monospace;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Poppins', sans-serif;
            min-width: 120px;
        }

        .action-btn i {
            margin-right: 6px;
        }

        .btn-navigate {
            background: #2196f3;
            color: white;
        }

        .btn-navigate:hover {
            background: #1976d2;
            transform: translateY(-2px);
        }

        .btn-call {
            background: #4caf50;
            color: white;
        }

        .btn-call:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-respond {
            background: #ff4444;
            color: white;
        }

        .btn-respond:hover {
            background: #cc0000;
            transform: translateY(-2px);
        }

        .btn-responding {
            background: #ff9800;
            color: white;
            cursor: default;
        }

        /* Stats Section */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 68, 68, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: #ff4444;
            font-size: 1.5rem;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: #555;
        }

        .empty-state p {
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Responsive Design */
        @media (min-width: 768px) {
            .emergency-grid {
                grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            }
            
            .action-buttons {
                flex-wrap: nowrap;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .emergency-card {
                padding: 20px;
            }
            
            .victim-info {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .volunteer-status {
                margin-left: 0;
            }
        }

        /* Alert Sound Animation */
        .sound-wave {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            display: none;
        }

        .sound-wave.active {
            display: block;
            animation: soundWave 1.5s ease-in-out infinite;
        }

        @keyframes soundWave {
            0%, 40%, 80%, 100% {
                opacity: 0;
                transform: scale(0.8);
            }
            20%, 60% {
                opacity: 1;
                transform: scale(1.2);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                Project Raksha - Volunteer
            </div>
            <div class="volunteer-status">
                <div class="status-dot"></div>
                Online & Ready
            </div>
        </div>
    </div>

    <!-- Alert Notification -->
    <div class="alert-notification" id="alertNotification">
        <div class="alert-header">
            <i class="fas fa-exclamation-triangle"></i>
            <div class="alert-title">üö® NEW EMERGENCY ALERT!</div>
        </div>
        <div class="alert-message">A new emergency has been reported in your area. Check details below.</div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Stats Section -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-number" id="activeAlerts">0</div>
                <div class="stat-label">Active Alerts</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-hands-helping"></i>
                </div>
                <div class="stat-number" id="responsesGiven">12</div>
                <div class="stat-label">Responses Given</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-number" id="onlineVolunteers">28</div>
                <div class="stat-label">Online Volunteers</div>
            </div>
        </div>

        <!-- Active Emergencies -->
        <div class="emergency-section">
            <div class="section-title">
                <i class="fas fa-fire"></i>
                Active Emergencies
            </div>
            <div class="emergency-grid" id="activeEmergencies">
                <!-- Emergency cards will be populated by JavaScript -->
            </div>
        </div>

        <!-- Recent Emergencies -->
        <div class="emergency-section">
            <div class="section-title">
                <i class="fas fa-history"></i>
                Recent Emergencies
            </div>
            <div class="emergency-grid" id="recentEmergencies">
                <!-- Recent emergency cards will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let emergencyAlerts = [];
        let respondingAlerts = new Set();
        let lastAlertCount = 0;

        // Emergency type icons mapping
        const emergencyIcons = {
            medical: 'fas fa-heartbeat',
            accident: 'fas fa-car-crash',
            fire: 'fas fa-fire',
            crime: 'fas fa-shield-alt'
        };

        // Initialize the volunteer dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadEmergencyAlerts();
            setInterval(checkForNewAlerts, 3000); // Check every 3 seconds
            populateRecentEmergencies();
            updateStats();
        });

        function loadEmergencyAlerts() {
            // Load alerts from localStorage
            const alerts = localStorage.getItem('emergencyAlerts');
            if (alerts) {
                emergencyAlerts = JSON.parse(alerts);
                renderActiveEmergencies();
                updateStats();
            }
        }

        function checkForNewAlerts() {
            const alerts = localStorage.getItem('emergencyAlerts');
            if (alerts) {
                const currentAlerts = JSON.parse(alerts);
                if (currentAlerts.length > lastAlertCount) {
                    // New alert detected
                    showAlertNotification();
                    playAlertSound();
                    emergencyAlerts = currentAlerts;
                    renderActiveEmergencies();
                    updateStats();
                }
                lastAlertCount = currentAlerts.length;
            }
        }

        function showAlertNotification() {
            const notification = document.getElementById('alertNotification');
            notification.classList.add('show');
            
            // Hide after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        function playAlertSound() {
            // In a real app, you would play an actual alert sound
            // For demo purposes, we'll just vibrate if available
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
        }

        function renderActiveEmergencies() {
            const container = document.getElementById('activeEmergencies');
            const activeAlerts = emergencyAlerts.filter(alert => alert.status === 'active');
            
            if (activeAlerts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <h3>All Clear!</h3>
                        <p>No active emergencies at the moment.<br>Great job keeping everyone safe!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = activeAlerts.map(alert => createEmergencyCard(alert, true)).join('');
        }

        function createEmergencyCard(alert, isActive = false) {
            const timeAgo = getTimeAgo(new Date(alert.timestamp));
            const isResponding = respondingAlerts.has(alert.id);
            
            return `
                <div class="emergency-card ${isActive ? 'urgent' : ''}">
                    <div class="sound-wave ${isActive ? 'active' : ''}">
                        <i class="fas fa-volume-up"></i>
                    </div>
                    
                    <div class="card-header">
                        <div class="emergency-type">
                            <div class="emergency-icon">
                                <i class="${emergencyIcons[alert.type]}"></i>
                            </div>
                            ${alert.type.charAt(0).toUpperCase() + alert.type.slice(1)} Emergency
                        </div>
                        <div class="timestamp">${timeAgo}</div>
                    </div>
                    
                    <div class="card-content">
                        <div class="victim-info">
                            <div class="info-item">
                                <i class="fas fa-user"></i>
                                <span>${alert.victim.name}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-birthday-cake"></i>
                                <span>${alert.victim.age} years</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-tint"></i>
                                <span>Blood: ${alert.victim.bloodGroup}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-id-badge"></i>
                                <span>${alert.id}</span>
                            </div>
                        </div>
                        
                        <div class="location-info">
                            <div class="location-header">
                                <i class="fas fa-map-marker-alt"></i>
                                Location Details
                            </div>
                            <div class="map-placeholder">
                                <i class="fas fa-map"></i>
                                <span>Interactive Map View</span>
                            </div>
                            <div class="coordinates">
                                üìç ${alert.location.address || `${alert.location.latitude.toFixed(4)}, ${alert.location.longitude.toFixed(4)}`}
                            </div>
                        </div>
                        
                        ${alert.voiceNote ? `
                            <div class="voice-note" style="background: #fff3cd; padding: 10px; border-radius: 8px; margin: 10px 0;">
                                <i class="fas fa-volume-up" style="color: #856404; margin-right: 8px;"></i>
                                <span style="color: #856404; font-size: 0.9rem;">Voice note available</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn btn-navigate" onclick="navigateToLocation('${alert.id}')">
                            <i class="fas fa-directions"></i>
                            Navigate
                        </button>
                        <button class="action-btn btn-call" onclick="callVictim('${alert.id}')">
                            <i class="fas fa-phone"></i>
                            Call
                        </button>
                        <button class="action-btn btn-respond ${isResponding ? 'btn-responding' : ''}" 
                                onclick="toggleResponse('${alert.id}')" 
                                ${isResponding ? 'disabled' : ''}>
                            <i class="fas fa-${isResponding ? 'check' : 'hand-paper'}"></i>
                            ${isResponding ? 'Responding' : "I'm Responding"}
                        </button>
                    </div>
                </div>
            `;
        }

        function populateRecentEmergencies() {
            const container = document.getElementById('recentEmergencies');
            
            // Mock recent emergencies for demo
            const recentAlerts = [
                {
                    id: 'EMRG-1234567890',
                    type: 'medical',
                    location: { address: 'Connaught Place, New Delhi' },
                    timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), // 2 hours ago
                    victim: { name: 'John Doe', age: 45, bloodGroup: 'A+' },
                    status: 'resolved'
                },
                {
                    id: 'EMRG-1234567891',
                    type: 'accident',
                    location: { address: 'India Gate, New Delhi' },
                    timestamp: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(), // 5 hours ago
                    victim: { name: 'Jane Smith', age: 28, bloodGroup: 'B+' },
                    status: 'resolved'
                }
            ];
            
            if (recentAlerts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <h3>No Recent Activity</h3>
                        <p>Recent emergency responses will appear here.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recentAlerts.map(alert => createEmergencyCard(alert, false)).join('');
        }

        function updateStats() {
            const activeAlerts = emergencyAlerts.filter(alert => alert.status === 'active').length;
            document.getElementById('activeAlerts').textContent = activeAlerts;
            
            // Mock updating other stats
            document.getElementById('responsesGiven').textContent = Math.floor(Math.random() * 20) + 10;
            document.getElementById('onlineVolunteers').textContent = Math.floor(Math.random() * 20) + 20;
        }

        function navigateToLocation(alertId) {
            const alert = emergencyAlerts.find(a => a.id === alertId);
            if (alert) {
                // In a real app, this would open Google Maps or similar
                const mapsUrl = `https://www.google.com/maps?q=${alert.location.latitude},${alert.location.longitude}`;
                
                // Show confirmation
                if (confirm('Open navigation to emergency location?')) {
                    // For demo, just show alert
                    alert('Navigation would open in Google Maps:\n' + mapsUrl);
                    // window.open(mapsUrl, '_blank'); // Uncomment for real implementation
                }
            }
        }

        function callVictim(alertId) {
            // In a real app, this would initiate a call
            if (confirm('This would normally call the emergency services or victim directly.\n\nProceed with mock call?')) {
                alert('üìû Connecting to emergency services...\n\nIn a real implementation, this would dial emergency services or the victim directly.');
            }
        }

        function toggleResponse(alertId) {
            if (respondingAlerts.has(alertId)) {
                return; // Already responding
            }
            
            if (confirm('Mark yourself as responding to this emergency?\n\nThis will notify other volunteers and the victim.')) {
                respondingAlerts.add(alertId);
                
                // Update the UI
                renderActiveEmergencies();
                
                // Show confirmation
                setTimeout(() => {
                    alert('‚úÖ Response confirmed!\n\nThe victim has been notified that help is on the way.\nStay safe and follow emergency protocols.');
                }, 500);
            }
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            return `${diffDays}d ago`;
        }

        // Auto-refresh data every 30 seconds
        setInterval(() => {
            loadEmergencyAlerts();
            updateStats();
        }, 30000);

        // Service Worker registration for notifications (mock)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(err => {
                console.log('Service Worker registration failed');
            });
        }

        // Handle visibility change to update when page becomes visible
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                loadEmergencyAlerts();
                updateStats();
            }
        });
    </script>
</body>
</html>